# Mass Drop Recovery Test
#
# Tests recovery from sudden connection loss (network event, DSQL failover).
# Uses the local configuration for fast testing.
#
# Scenario:
# - Services start and fill reservoir
# - At 5 minutes, 50% of connections are dropped
# - Observe recovery time (refiller should quickly restore)

seed: 42
endpoint: cluster.dsql.eu-west-1.on.aws

duration: 15m
sampleEvery: 1s

limiterPerSec: 100

assertMaxConnectsPerSec: 100
assertConvergeWithin: 60s
assertStableFor: 5s
assertZeroEmptyEvents: true

scenario:
  kind: mass_drop
  dropAt: 5m
  dropFraction: 0.5

services:
  - name: history
    targetReady: 50
    guardWindow: 45s
    baseLifetime: 11m
    jitter: 2m
    startDelay: 0s

  - name: matching
    targetReady: 50
    guardWindow: 45s
    baseLifetime: 11m
    jitter: 2m
    startDelay: 100ms

  - name: frontend
    targetReady: 50
    guardWindow: 45s
    baseLifetime: 11m
    jitter: 2m
    startDelay: 200ms

  - name: worker
    targetReady: 50
    guardWindow: 45s
    baseLifetime: 11m
    jitter: 2m
    startDelay: 300ms
