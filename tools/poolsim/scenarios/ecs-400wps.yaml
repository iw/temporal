# ECS 400 WPS Configuration
#
# Simulates a production ECS deployment for 400 WPS workloads.
#
# Services:
# - 16 History × 500 connections = 8,000
# - 16 Matching × 500 connections = 8,000
# - 9 Frontend × 500 connections = 4,500
# - 3 Worker × 500 connections = 1,500
# Total: 22,000 connections
#
# IMPORTANT: This exceeds DSQL's 10,000 connection limit!
# The simulation will show how services compete for connections.
#
# Expected convergence: ~220 seconds (22,000 / 100 = 220s)
# But will be limited by DSQL's max connections.

seed: 42
endpoint: cluster.dsql.eu-west-1.on.aws

duration: 30m
sampleEvery: 1s

limiterPerSec: 100

assertMaxConnectsPerSec: 100
assertConvergeWithin: 300s  # 5 minutes
assertMaxClosurePerSec: 500

scenario:
  kind: cold_start

services:
  # History (16 replicas × 500 connections)
  - name: history-01
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 0ms

  - name: history-02
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 50ms

  - name: history-03
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 100ms

  - name: history-04
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 150ms

  - name: history-05
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 200ms

  - name: history-06
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 250ms

  - name: history-07
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 300ms

  - name: history-08
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 350ms

  - name: history-09
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 400ms

  - name: history-10
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 450ms

  - name: history-11
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 500ms

  - name: history-12
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 550ms

  - name: history-13
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 600ms

  - name: history-14
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 650ms

  - name: history-15
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 700ms

  - name: history-16
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 750ms

  # Matching (16 replicas × 500 connections)
  - name: matching-01
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 800ms

  - name: matching-02
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 850ms

  - name: matching-03
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 900ms

  - name: matching-04
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 950ms

  - name: matching-05
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1000ms

  - name: matching-06
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1050ms

  - name: matching-07
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1100ms

  - name: matching-08
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1150ms

  - name: matching-09
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1200ms

  - name: matching-10
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1250ms

  - name: matching-11
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1300ms

  - name: matching-12
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1350ms

  - name: matching-13
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1400ms

  - name: matching-14
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1450ms

  - name: matching-15
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1500ms

  - name: matching-16
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1550ms

  # Frontend (9 replicas × 500 connections)
  - name: frontend-1
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1600ms

  - name: frontend-2
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1650ms

  - name: frontend-3
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1700ms

  - name: frontend-4
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1750ms

  - name: frontend-5
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1800ms

  - name: frontend-6
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1850ms

  - name: frontend-7
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1900ms

  - name: frontend-8
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 1950ms

  - name: frontend-9
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 2000ms

  # Worker (3 replicas × 500 connections)
  - name: worker-1
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 2050ms

  - name: worker-2
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 2100ms

  - name: worker-3
    targetOpen: 500
    maxOpen: 500
    maxConnLifetime: 10m
    warmupStagger: 2m
    keeperTick: 1s
    maxConnsPerTick: 5
    startDelay: 2150ms
