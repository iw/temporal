# Local testing configuration for temporal-dsql without external dependencies
# Uses SQLite for persistence and disables visibility for minimal testing

log:
  stdout: true
  level: info
  format: pretty

persistence:
  defaultStore: default
  # Disable visibility store for minimal testing
  # visibilityStore: visibility
  datastores:
    default:
      sql:
        pluginName: "sqlite"
        databaseName: "/tmp/temporal/temporal.db"
        connectAddr: "file:/tmp/temporal/temporal.db"
        maxConns: 20
        maxIdleConns: 20
    # Commented out visibility store to avoid OpenSearch dependency
    # visibility:
    #   sql:
    #     pluginName: "sqlite"
    #     databaseName: "/tmp/temporal/visibility.db"
    #     connectAddr: "file:/tmp/temporal/visibility.db"
    #     maxConns: 10
    #     maxIdleConns: 10

global:
  membership:
    maxJoinDuration: 30s
    broadcastAddress: "127.0.0.1"
  pprof:
    port: 7936
  metrics:
    prometheus:
      timerType: "histogram"
      listenAddress: "127.0.0.1:9090"

services:
  frontend:
    rpc:
      grpcPort: 7233
      membershipPort: 6933
      bindOnIP: "0.0.0.0"
    metrics:
      prometheus:
        timerType: "histogram"
        listenAddress: "0.0.0.0:9090"

  matching:
    rpc:
      grpcPort: 7235
      membershipPort: 6935
      bindOnIP: "0.0.0.0"

  history:
    rpc:
      grpcPort: 7234
      membershipPort: 6934
      bindOnIP: "0.0.0.0"

  worker:
    rpc:
      grpcPort: 7239
      membershipPort: 6939
      bindOnIP: "0.0.0.0"

# Disable cluster metadata for single-node testing
clusterMetadata:
  enableGlobalNamespace: false
  failoverVersionIncrement: 10
  masterClusterName: "active"
  currentClusterName: "active"
  clusterInformation:
    active:
      enabled: true
      initialFailoverVersion: 1
      rpcName: "frontend"
      rpcAddress: "127.0.0.1:7233"

# Dynamic configuration for local testing
dynamicConfigClient:
  filepath: "/etc/temporal/config/dynamicconfig/local-test.yaml"
  pollInterval: "10s"